---
title: LDA
author: dondon
date: '2021-01-06'
slug: lda
categories:
  - R
tags:
  - statistics
---

# LDA와 regression 사이의 유사도 설명
# https://online.stat.psu.edu/stat508/lesson/8/8.5/8.5.1

# LDA class 2개일 때 예시 

```{r, echo=F, warning=F, include=F}
library(tidyverse)
library(gridExtra)
library(MASS)
library(caret)
library(klaR)
library(mda)
library(data.table)
```

```{r}
dat <- data.frame(A1=c(2.95, 2.53, 3.57, 3.16, 2.58, 2.16, 3.27), 
                  A2=c(6.63, 7.79, 5.65, 5.47, 4.46, 6.22, 3.52),
                  y=c('passed','passed','passed','passed', 'not passed', 'not passed', 'not passed'))

dat$y <- as.factor(dat$y)
dat$y <- factor(dat$y, levels = c('passed', 'not passed'))

dat

x1 <- as.matrix(filter(dat,y == 'passed')[,-3])
x2 <- as.matrix(filter(dat, y == 'not passed')[,-3])

mu1 <- as.vector(apply(x1, 2, mean))
mu2 <- as.vector(apply(x2, 2, mean))
mu <- as.vector(apply(dat[,-3], 2, mean))

x10 <- cbind((x1[,1]-mu[1]), (x1[,2]-mu[2]))
x20 <- cbind((x2[,1]-mu[1]), (x2[,2]-mu[2]))

c1 <- t(x10)%*%x10/nrow(x1)
c2 <- t(x20)%*%x20/nrow(x2)
```


# pooled within group covariance matrix 
```{r}
c <- ((nrow(x1)*c1)+(nrow(x2)*c2))/nrow(dat)
cinverse <- solve(c)
```


# prior vector 
```{r}
p <- c(nrow(x1)/nrow(dat), nrow(x2)/nrow(dat))
```

# discriminant function
```{r}
mu1 <- as.matrix(mu1)
dim(mu1)
v <- as.matrix(x1[1,])
dim(v)
dim(cinverse)
p <- as.matrix(p)
t(mu1)%*%cinverse%*%v-(0.5*t(mu1)%*%cinverse%*%mu1)-p[1,1]
t(mu2)%*%cinverse%*%v-(0.5*t(mu2)%*%cinverse%*%mu2)-p[2,1]
```


```{r}
fit <- lda(y~A1+A2, data = dat)
fit$means
```



# LDA class 2개 이상일 때 예시 
```{r}
head(iris)
dim(iris)
```



```{r}
glimpse(iris)

iris$Species <- as.factor(iris$Species)

theme_set(theme_bw())
p1 <- iris %>% 
        ggplot(aes(x=Sepal.Length, fill = Species))+geom_histogram()
p2 <- iris %>% 
        ggplot(aes(x=Sepal.Width, fill = Species))+geom_histogram()
p3 <- iris %>% 
        ggplot(aes(x=Petal.Length, fill = Species))+geom_histogram()
p4 <- iris %>% 
        ggplot(aes(x=Petal.Width, fill = Species))+geom_histogram()
grid.arrange(p1, p2, p3, p4, ncol = 2, nrow = 2)
```


# LDA 링크 참고 
# http://www.sthda.com/english/articles/36-classification-methods-essentials/146-discriminant-analysis-essentials-in-r/



caret::createDataPartition(
        y,          # 분류(또는 레이블)
        times=1,    # 생성할 분할의 수
        p=0.5,      # 훈련 데이터에서 사용할 데이터의 비율
        list=TRUE,  # 결과를 리스트로 반환할지 여부. FALSE면 행렬을 반환한다.
)

```{r}
set.seed(123)
train.sample <- iris$Species %>% 
        createDataPartition(p=0.8, list = F)
train.data <- iris[train.sample, ]
test.data <- iris[-train.sample, ]
```

Discriminant analysis can be affected by the scale/unit in which predictor variables are measured. 
It’s generally recommended to standardize/normalize continuous predictor before the analysis.

caret::preProcess(
       data : data.frame 형태로 지정해주어야함 
       method = 'scale' : 중심화 (평균값을 뺀다)
       method = 'center' : 척도화 (표준편차로 나눈다)
       method = c('center', 'scale') : 정규화 
       method = c('range') : 데이터를 [0, 1] 사이의 값으로 조정
       method = c('BoxCox'), fundge = 0.2 : 데이터의 분포가 치우쳐져 있을 때 각 predictor 별로 lambda값을 지정한다. 
        fundge : lambda (0-0.2, 0+0.2)는 0으로 지정 
       method = 'pca' , pcaComp = 3 : pca 적용, 주성분의 수 (pca만 적용해도 center, scale이 한번에 적용됨)
       method = ''nzv' : 변수의 분산이 거의 0인 경우 제거
       method = 'zv' : 변수의 모든 값이 같은 경우 제거
       method = 'knnlmpute' : knn 기법을 이용해 NA 근처의 값들을 가중평균해서 값을 채움. RANN 패키지 필요  
       method = 'bagImpute' : bagged tree model을 통해 결측치를 채움
       method = 'medianImpute' : median을 이용해서 결측치를 채움


predict를 적용해야 데이터 변환 가능 
dat <- predict(preeprocess를 적용한 데이터, 원 데이터) 변환된 데이터 생성 


```{r}
preproc.param <- train.data %>% 
        preProcess(method = c('center', 'scale'))


train.transformed <- preproc.param %>% predict(train.data)
test.transformed <- preproc.param %>% predict(test.data)
```



# fit the model
```{r}
model <- lda(Species~., data = train.transformed)
plot(model)
lda.data <- cbind(train.transformed, predict(model)$x)
ggplot(lda.data, aes(LD1, LD2)) + 
        geom_point(aes(color = Species))
```
# prediction

```{r}
predictions <- model %>% predict(test.transformed)
```

# model accuracy
```{r}
mean(predictions$class == test.transformed$Species)
```

# QDA
```{r}
model <- qda(Species~., data = train.transformed)
model

predictions <- model %>% predict(test.transformed)
mean(predictions$class == test.transformed$Species)
```



# MDA (Mixture discriminant analysis)
```{r}
model <- mda(Species~., data = train.transformed)
predictions <- model %>% predict(test.transformed)
mean(predictions == test.transformed$Species)
```

# FDA (flexible discriminant analysis)
```{r}
model <- fda(Species~., data = train.transformed)
predictions <- model %>% predict(test.transformed)
mean(predictions == test.transformed$Species)
```

# RDA ( regularized discriminant analysis)
```{r}

model <- rda(Species~., data = train.transformed)
predictions <- model %>% predict(test.transformed)
mean(predictions$class == test.transformed$Species)
```



# vowel data 
```{r}
url1 <- 'https://web.stanford.edu/~hastie/ElemStatLearn/datasets/vowel.train'
url2 <- 'https://web.stanford.edu/~hastie/ElemStatLearn/datasets/vowel.test'

download.file(url1, destfile = 'C:/Users/uos/Desktop/train.txt')
download.file(url2, destfile = 'C:/Users/uos/Desktop/test.txt')

setwd('C:/Users/uos/Desktop')
train <- fread('train.txt')
test <- fread('test.txt')

glimpse(train)
head(train)
head(test)
train <- train[,-1]
test <- test[,-1]

train$y <- as.factor(train$y)
test$y <- as.factor(test$y)


preproc.param <- train %>% 
        preProcess(method = c('center', 'scale'))


train.transformed <- preproc.param %>% predict(train)
test.transformed <- preproc.param %>% predict(test)
```

# fit the model
```{r}
model <- lda(y~., data = train.transformed)
lda.data <- cbind(train.transformed, predict(model)$x)
ggplot(lda.data, aes(LD1, LD2)) + 
        geom_point(aes(color = y))
```
# prediction
```{r}
predictions <- model %>% predict(test.transformed)
```
# model accuracy
```{r}
mean(predictions$class == test.transformed$y)
```
# misclassification 
```{r}
1-mean(predictions$class == test.transformed$y)
```

